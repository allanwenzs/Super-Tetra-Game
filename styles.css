    :root{
      --bg0:#0b1020;
      --bg1:#0f1833;
      --text:#e9eeff;
      --muted:#93a0d8;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 18px;
      --glass: linear-gradient(180deg, rgba(17,26,60,.92), rgba(11,19,47,.88));
      --glass2: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, #22306a 0%, transparent 60%),
        radial-gradient(1200px 800px at 80% 30%, #4b1b7a 0%, transparent 55%),
        radial-gradient(1200px 800px at 50% 100%, #0c5d6a 0%, transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{
      width:min(1200px, 100%);
      height: 100vh;
      display:grid;
      grid-template-columns: minmax(640px, 1fr) 360px;
      grid-template-areas: "board side";
      gap:18px;
      align-items:stretch;
      overflow:hidden;
    }
    .card{
      background: var(--glass);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .boardWrap{ position:relative; padding:14px; }
    canvas#game{
      width:100%;
      height:auto;
      display:block;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(10,16,40,.95), rgba(7,12,30,.96));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      touch-action:none;
    }

    .hud{
      display:grid;
      grid-template-rows: auto auto auto 1fr auto;
      gap:14px;
      padding:16px;
    }
    .titleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .logo{ display:flex; gap:10px; align-items:center; }
    .badge{
      width:40px;height:40px;border-radius:12px;
      background: linear-gradient(135deg, rgba(90,255,255,.18), rgba(255,90,255,.15));
      border:1px solid rgba(255,255,255,.10);
      display:grid;place-items:center;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    h1{ margin:0; font-size:18px; letter-spacing:.3px; line-height:1.1; }
    .sub{ margin-top:2px; color:var(--muted); font-size:12px; }

    .pill{
      font-size:12px;
      color: rgba(255,255,255,.92);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      padding:8px 10px;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .pill b{ font-weight:900; }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .stat{
      padding:12px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    .stat.full{ grid-column: 1 / -1; }
    .stat .k{
      color:var(--muted);
      font-size:12px;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .stat .v{ font-size:20px; font-weight:900; letter-spacing:.2px; }
    .stat .subv{
      margin-top:6px;
      font-size:12px;
      color:rgba(233,238,255,.78);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .panel{
      padding:12px;
      border-radius: 14px;
      background: var(--glass2);
      border:1px solid rgba(255,255,255,.08);
    }
    .panel h3{
      margin:0 0 10px 0;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.4px;
      text-transform:uppercase;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .miniRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:stretch;
    }
    .miniBox{
      display:grid;
      grid-template-rows:auto 1fr;
      gap:8px;
    }
    .miniLabel{
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:0 2px;
      gap:10px;
      flex-wrap:wrap;
    }
    .miniCanvas{
      width:100%;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(10,16,40,.85), rgba(7,12,30,.92));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.06);
      display:block;
    }

    .help{
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .help kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size:11px;
      padding:2px 6px;
      border-radius:8px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.9);
      white-space:nowrap;
    }

    .footerRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      color:var(--muted);
      font-size:12px;
      padding-top:4px;
      flex-wrap:wrap;
    }
    .btn{
      cursor:pointer;
      border:none;
      border-radius: 12px;
      padding:10px 12px;
      color: rgba(255,255,255,.92);
      background: linear-gradient(135deg, rgba(108,255,214,.18), rgba(115,139,255,.18));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px) scale(.99); filter: brightness(.98); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    .toggle, select, input[type="range"]{ font-size:12px; }
    .toggle{
      cursor:pointer;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      user-select:none;
      white-space:nowrap;
    }
    .toggle.on{
      background: linear-gradient(135deg, rgba(120,255,220,.18), rgba(160,180,255,.18));
      border-color: rgba(255,255,255,.16);
    }
    select{
      cursor:pointer;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      outline:none;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    .overlay{
      position:absolute;
      inset:14px;
      border-radius: 14px;
      display:none;
      align-items:center;
      justify-content:center;
      background: radial-gradient(800px 500px at 50% 30%, rgba(120,160,255,.18) 0%, rgba(10,16,40,.85) 55%, rgba(7,12,30,.92) 100%);
      backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.08);
      z-index:20;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(560px, 92%);
      border-radius: 18px;
      padding:16px;
      background: linear-gradient(180deg, rgba(16,26,58,.92), rgba(11,19,47,.90));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
    }
    .modal .big{
      font-size:34px;
      font-weight:900;
      letter-spacing:.5px;
      margin:8px 0 2px;
      background: linear-gradient(90deg, rgba(160,255,230,1), rgba(180,190,255,1), rgba(255,170,240,1));
      -webkit-background-clip: text;
      background-clip: text;
      color:transparent;
      text-align:center;
    }
    .modal .miniStats{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin:6px 0 10px;
      color:rgba(233,238,255,.86);
      font-size:13px;
    }
    .modal .miniStats b{ color: rgba(255,255,255,.95); }

    .toast{
      position:absolute;
      left:50%;
      top:18px;
      transform: translateX(-50%);
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      font-size:12px;
      display:none;
      gap:8px;
      align-items:center;
      user-select:none;
      z-index:25;
      white-space:nowrap;
    }
    .toast.show{ display:flex; }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: rgba(120,255,200,.85);
      box-shadow: 0 0 18px rgba(120,255,200,.55);
    }

    .leader{
      margin-top:12px;
      padding:12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
    }
    .leader h4{
      margin:0 0 8px 0;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.4px;
      text-transform:uppercase;
    }
    .leader ol{
      margin:0;
      padding-left:18px;
      color: rgba(255,255,255,.92);
      font-size:13px;
      line-height:1.55;
    }
    .leader small{ color:var(--muted); }

    .settingsGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .setting{
      padding:10px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
    }
    .setting .k{
      color:var(--muted);
      font-size:12px;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .setting .k b{ color:rgba(233,238,255,.9); font-weight:900; }
    input[type="range"]{ width:100%; }

    .bindGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .bindRow{
      padding:10px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .bindRow .k{
      font-size:12px;
      color:var(--muted);
    }
    .bindKey{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size:11px;
      padding:6px 8px;
      border-radius:10px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .bindKey.listening{
      outline: 2px solid rgba(120,255,220,.55);
      box-shadow: 0 0 0 6px rgba(120,255,220,.10);
    }
  

/* ===== STG UI REWORK: game-first, no page scroll ===== */
html, body{
  width:100%;
  height:100%;
  margin:0;
  overflow:hidden;
}
.app{
      width:min(1200px, 100%);
      height: 100vh;
      display:grid;
      grid-template-columns: minmax(640px, 1fr) 360px;
      grid-template-areas: "board side";
      gap:18px;
      align-items:stretch;
      overflow:hidden;
    }
@media (max-width: 980px){
  .app{
      width:min(1200px, 100%);
      height: 100vh;
      display:grid;
      grid-template-columns: minmax(640px, 1fr) 360px;
      grid-template-areas: "board side";
      gap:18px;
      align-items:stretch;
      overflow:hidden;
    }
  .boardWrap{ height: calc(100vh - 18px); }
  .side{ order: 0 !important; }
}

.boardWrap{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
canvas#game{
  height: calc(100vh - 32px);
  width: auto;
  max-height: 100%;
  max-width: 100%;
  aspect-ratio: 1 / 2;
}

/* Right panel becomes compact and game-focused */
.side .hud{
  grid-template-rows: auto auto auto auto 1fr auto;
}

/* Compact control buttons */
.controlRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  margin-top:10px;
}
.controlRow .btn{
  flex: 1 1 140px;
  min-height: 42px;
}

/* Collapsible menus */
.menu{
  margin-top:12px;
}
.menu > summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
  padding:10px 12px;
  border-radius: 12px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-weight:700;
}
.menu[open] > summary{
  background: rgba(255,255,255,.09);
}
.menuContent{
  margin-top:10px;
  max-height: 42vh;
  overflow:auto;
  padding-right:4px;
}

/* Compact stats row */
.compactStats{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap:10px;
  margin-top:12px;
}
@media (min-width: 1100px){
  .compactStats{ grid-template-columns: repeat(4, minmax(0,1fr)); }
}

.boardWrap{ grid-area: board; }
.side{ grid-area: side; overflow:auto; min-height:0; }

/* ===== Exit (Close App) helper modal ===== */
.exitBackdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10050;
}
.exitBackdrop:target{ display:flex; }
.exitCard{
  width: min(560px, 92vw);
  border-radius: 18px;
  padding: 16px 16px 14px;
  background: linear-gradient(180deg, rgba(16,26,58,.94), rgba(11,19,47,.92));
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: var(--shadow);
  color: var(--text);
}
.exitCard h2{
  margin: 0 0 8px;
  font-size: 16px;
  letter-spacing: .2px;
}
.exitCard p{
  margin: 0 0 10px;
  color: rgba(233,238,255,.88);
  font-size: 13px;
  line-height: 1.45;
}
.exitCard ul{
  margin: 0 0 12px 18px;
  padding: 0;
  color: rgba(233,238,255,.88);
  font-size: 13px;
  line-height: 1.45;
}
.exitCard li{ margin: 6px 0; }
.exitCard .rowBtns{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  flex-wrap:wrap;
}


.buildTag{
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 999px;
  margin-left: 8px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.10);
  color: rgba(233,238,255,.85);
  vertical-align: middle;
}


.ownerLine{
  color: rgba(233,238,255,.72);
  font-size: 11px;
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.ownerLine a{
  color: rgba(180,190,255,.95);
  text-decoration: none;
  border-bottom: 1px dashed rgba(180,190,255,.45);
}
.ownerLine a:hover{ filter: brightness(1.05); }
